[2023-01-30 09:31:50,366] [WARNING][deprecation.py:350:new_func] From /usr/local/lib/python3.8/site-packages/tensorflow/python/compat/v2_compat.py:107: disable_resource_variables (from tensorflow.python.ops.variable_scope) is deprecated and will be removed in a future version.
Instructions for updating:
non-resource variables are not supported in the long term
[2023-01-30 09:31:50,473] [INFO][local_entry.py:20:<module>] WORKFLOW_ID: test_id, USERNUMBER: test_user
[2023-01-30 09:31:50,474] [INFO][local_entry.py:26:<module>] local entry is running
[2023-01-30 09:31:50,479] [INFO][conf_util.py:193:get_conf] Entering get_conf, original py_conf is conf.TrainConf
[2023-01-30 09:31:50,487] [INFO][conf_util.py:176:merge_configs] override sequence is py_conf
[2023-01-30 09:31:50,488] [INFO][conf_util.py:181:merge_configs] conf after merge is {'batch_size': 64, 'classifier_class': <class 'MyEstimator.MyEstimator'>, 'epoch': 1000, 'eval_set': {'path': 'fake://eval.data', 'columns': ({dtype=float32;name=x;is_sparse=None;is_label=False}, {dtype=float32;name=y;is_sparse=None;is_label=True})}, 'eval_steps': 10, 'log_steps': 100, 'model_dir': '/nas', 'params': {'deep_embedding_dim': 8, 'learning_rate': 0.0001, 'l1': 0.0, 'l21': 0.0, 'l2': 0.0, 'optimizer': 'group_adam', 'log_steps': 100}, 'priority': 1073741824, 'save_steps': 500, 'train_set': {'path': 'fake://test.data', 'columns': ({dtype=float32;name=x;is_sparse=None;is_label=False}, {dtype=float32;name=y;is_sparse=None;is_label=True})}}
[2023-01-30 09:31:50,489] [INFO][starter.py:72:execute] Running platform: KUBERNETES, worker action: run
[2023-01-30 09:31:50,491] [INFO][base_executor.py:72:get_cluster_info_by_tf_config] cluster spec is {'ps': ['localhost:57859'], 'chief': ['localhost:37963'], 'evaluator': ['localhost:41055']}                 task_type is chief                 task_id is 0                 address is localhost:37963
[2023-01-30 09:31:50,492] [INFO][conf_util.py:63:get] get value from conf: the key is model_dir and value is /nas
[2023-01-30 09:31:50,495] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'str'>
[2023-01-30 09:31:50,497] [INFO][conf_util.py:63:get] get value from conf: the key is classifier_class and value is <class 'MyEstimator.MyEstimator'>
[2023-01-30 09:31:50,499] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'type'>
[2023-01-30 09:31:50,502] [INFO][estimator_executor.py:129:_prepare_estimator] found `classifier_class` in your estimator class dlrover.trainer will decide the training and evaluting process.
[2023-01-30 09:31:50,507] [INFO][conf_util.py:63:get] get value from conf: the key is train_set and value is {'path': 'fake://test.data', 'columns': ({dtype=float32;name=x;is_sparse=None;is_label=False}, {dtype=float32;name=y;is_sparse=None;is_label=True})}
[2023-01-30 09:31:50,510] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'dict'>
[2023-01-30 09:31:50,513] [INFO][conf_util.py:31:new_func] key reader_fn, def None
[2023-01-30 09:31:50,516] [INFO][conf_util.py:63:get] get value from conf: the key is eval_set and value is {'path': 'fake://eval.data', 'columns': ({dtype=float32;name=x;is_sparse=None;is_label=False}, {dtype=float32;name=y;is_sparse=None;is_label=True})}
[2023-01-30 09:31:50,521] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'dict'>
[2023-01-30 09:31:50,524] [INFO][conf_util.py:31:new_func] key reader_fn, def None
[2023-01-30 09:31:50,527] [INFO][conf_util.py:63:get] get value from conf: the key is max_steps and value is None
[2023-01-30 09:31:50,529] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'NoneType'>
[2023-01-30 09:31:50,536] [INFO][conf_util.py:63:get] get value from conf: the key is eval_steps and value is 10
[2023-01-30 09:31:50,539] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'int'>
[2023-01-30 09:31:50,545] [INFO][estimator_executor.py:234:_prepare_eval_spec] Adding export to estimator_spec
[2023-01-30 09:31:50,547] [INFO][run_config.py:549:__init__] TF_CONFIG environment variable: {'cluster': {'ps': ['localhost:57859'], 'chief': ['localhost:37963'], 'evaluator': ['localhost:41055']}, 'task': {'type': 'chief', 'index': 0}}
[2023-01-30 09:31:50,554] [INFO][base_executor.py:120:get_cluster_def] cluster def is:
 job {
  name: "ps"
  tasks {
    key: 0
    value: "localhost:57859"
  }
}
job {
  name: "chief"
  tasks {
    key: 0
    value: "localhost:37963"
  }
}

[2023-01-30 09:31:50,557] [INFO][run_config.py:549:__init__] TF_CONFIG environment variable: {'cluster': {'ps': ['localhost:57859'], 'chief': ['localhost:37963'], 'evaluator': ['localhost:41055']}, 'task': {'type': 'chief', 'index': 0}, 'environment': 'google'}
[2023-01-30 09:31:50,559] [INFO][base_executor.py:161:get_config] Using _get_run_config : {'_model_dir': None, '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': device_filters: "/job:ps"
device_filters: "/job:chief"
allow_soft_placement: true
graph_options {
  rewrite_options {
    meta_optimizer_iterations: ONE
  }
}
, '_keep_checkpoint_max': 5, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 100, '_train_distribute': None, '_device_fn': None, '_protocol': None, '_eval_distribute': None, '_experimental_distribute': None, '_experimental_max_worker_delay_secs': None, '_session_creation_timeout_secs': 7200, '_checkpoint_save_graph_def': True, '_service': None, '_cluster_spec': ClusterSpec({'chief': ['localhost:37963'], 'evaluator': ['localhost:41055'], 'ps': ['localhost:57859']}), '_task_type': 'chief', '_task_id': 0, '_evaluation_master': '', '_master': 'grpc://localhost:37963', '_num_ps_replicas': 1, '_num_worker_replicas': 1, '_global_id_in_cluster': 0, '_is_chief': True}
[2023-01-30 09:31:50,561] [INFO][base_executor.py:169:get_config] mini cluster spec is {'ps': ['localhost:57859'], 'chief': ['localhost:37963']}
[2023-01-30 09:31:50,564] [INFO][global_step_hook.py:29:__init__] ModelSizeHook: every_n_iter: 1
[2023-01-30 09:31:50,566] [INFO][estimator_executor.py:158:_prepare_estimator_config_and_params] appending ElasticDataShardReportHook
[2023-01-30 09:31:50,569] [INFO][conf_util.py:63:get] get value from conf: the key is save_steps and value is 500
[2023-01-30 09:31:50,572] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'int'>
[2023-01-30 09:31:50,574] [INFO][conf_util.py:63:get] get value from conf: the key is save_secs and value is None
[2023-01-30 09:31:50,576] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'NoneType'>
[2023-01-30 09:31:50,581] [INFO][estimator_executor.py:171:_prepare_estimator_config_and_params] checkpoint hook /nas
[2023-01-30 09:31:50,584] [INFO][basic_session_run_hooks.py:557:__init__] Create CheckpointSaverHook.
[2023-01-30 09:31:50,589] [INFO][conf_util.py:63:get] get value from conf: the key is train_set and value is ConfigTree([('path', 'fake://test.data'), ('columns', ({dtype=float32;name=x;is_sparse=None;is_label=False}, {dtype=float32;name=y;is_sparse=None;is_label=True}))])
[2023-01-30 09:31:50,592] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'pyhocon.config_tree.ConfigTree'>
[2023-01-30 09:31:50,595] [INFO][estimator_executor.py:181:_prepare_estimator_config_and_params] config is <tensorflow_estimator.python.estimator.run_config.RunConfig object at 0x7fc103b0d700>
[2023-01-30 09:31:50,598] [INFO][conf_util.py:63:get] get value from conf: the key is params and value is {'deep_embedding_dim': 8, 'learning_rate': 0.0001, 'l1': 0.0, 'l21': 0.0, 'l2': 0.0, 'optimizer': 'group_adam', 'log_steps': 100}
[2023-01-30 09:31:50,601] [INFO][conf_util.py:66:get] get value from conf: value type is <class 'dict'>
[2023-01-30 09:31:50,607] [INFO][MyEstimator.py:28:__init__] config is <tensorflow_estimator.python.estimator.run_config.RunConfig object at 0x7fc103b0d700>
[2023-01-30 09:31:50,610] [INFO][MyEstimator.py:29:__init__] model_dir is <tensorflow_estimator.python.estimator.run_config.RunConfig object at 0x7fc103b0d700>
[2023-01-30 09:31:50,614] [INFO][estimator.py:202:__init__] Using config: {'_model_dir': '/nas', '_tf_random_seed': None, '_save_summary_steps': 100, '_save_checkpoints_steps': None, '_save_checkpoints_secs': 600, '_session_config': gpu_options {
  allow_growth: true
}
allow_soft_placement: true
cluster_def {
  job {
    name: "ps"
    tasks {
      key: 0
      value: "localhost:57859"
    }
  }
  job {
    name: "chief"
    tasks {
      key: 0
      value: "localhost:37963"
    }
  }
}
experimental {
  share_session_state_in_clusterspec_propagation: true
}
, '_keep_checkpoint_max': 20, '_keep_checkpoint_every_n_hours': 10000, '_log_step_count_steps': 10, '_train_distribute': None, '_device_fn': None, '_protocol': 'grpc', '_eval_distribute': None, '_experimental_distribute': None, '_experimental_max_worker_delay_secs': None, '_session_creation_timeout_secs': 7200, '_checkpoint_save_graph_def': True, '_service': None, '_cluster_spec': ClusterSpec({'chief': ['localhost:37963'], 'ps': ['localhost:57859']}), '_task_type': 'chief', '_task_id': 0, '_evaluation_master': '', '_master': 'grpc://localhost:37963', '_num_ps_replicas': 1, '_num_worker_replicas': 1, '_global_id_in_cluster': 0, '_is_chief': True, '_server_name': 'localhost:37963'}
[2023-01-30 09:31:50,618] [INFO][tf_kubernetes_worker.py:53:run] KubernetesWorker is running!
[2023-01-30 09:31:50,622] [INFO][base_executor.py:129:start_server] starting server
[2023-01-30 09:31:50,636] [INFO][estimator_executor.py:245:train_and_evaluate] starting train and evaluate
[2023-01-30 09:31:50,640] [INFO][estimator_training.py:182:should_run_distribute_coordinator] Not using Distribute Coordinator.
[2023-01-30 09:31:50,671] [WARNING][deprecation.py:350:new_func] From /usr/local/lib/python3.8/site-packages/tensorflow/python/training/training_util.py:396: Variable.initialized_value (from tensorflow.python.ops.variables) is deprecated and will be removed in a future version.
Instructions for updating:
Use Variable.read_value. Variables in 2.X are initialized automatically both in eager and graph (inside tf.defun) contexts.
[2023-01-30 09:31:50,691] [INFO][dataset_util.py:65:make_dataset] building dataset with reader
[2023-01-30 09:31:50,692] [INFO][dataset_util.py:68:make_dataset] Make dataset from reader_fn
[2023-01-30 09:31:50,694] [WARNING][deprecation.py:554:new_func] From /home/dlrover/dlrover/trainer/tensorflow/util/dataset_util.py:69: calling DatasetV2.from_generator (from tensorflow.python.data.ops.dataset_ops) with output_types is deprecated and will be removed in a future version.
Instructions for updating:
Use output_signature instead
[2023-01-30 09:31:50,791] [INFO][estimator.py:1173:_call_model_fn] Calling model_fn.
[2023-01-30 09:31:51,002] [INFO][estimator.py:1175:_call_model_fn] Done calling model_fn.
[2023-01-30 09:31:51,004] [INFO][estimator_util.py:26:append_hooks] Hooks before deduplication: training_chief_hooks = ['CheckpointSaverHook']
[2023-01-30 09:31:51,006] [INFO][estimator_util.py:44:append_hooks] Appending hooks after deduplication: training_chief_hooks = ['CheckpointSaverHook']
[2023-01-30 09:31:51,008] [INFO][estimator_util.py:26:append_hooks] Hooks before deduplication: training_hooks = ['GlobalStepHook', 'ElasticDataShardReportHook', 'ReportModelMetricHook']
[2023-01-30 09:31:51,009] [INFO][estimator_util.py:44:append_hooks] Appending hooks after deduplication: training_hooks = ['GlobalStepHook', 'ElasticDataShardReportHook', 'ReportModelMetricHook']
[2023-01-30 09:31:51,110] [INFO][monitored_session.py:240:finalize] Graph was finalized.
[2023-01-30 09:31:51,113] [INFO][saver.py:1410:restore] Restoring parameters from /nas/model.ckpt-6
[2023-01-30 09:31:51,159] [WARNING][deprecation.py:350:new_func] From /usr/local/lib/python3.8/site-packages/tensorflow/python/training/saver.py:1173: get_checkpoint_mtimes (from tensorflow.python.checkpoint.checkpoint_management) is deprecated and will be removed in a future version.
Instructions for updating:
Use standard file utilities to get mtimes.
[2023-01-30 09:31:51,189] [INFO][session_manager.py:526:_try_run_local_init_op] Running local_init_op.
[2023-01-30 09:31:51,204] [INFO][session_manager.py:529:_try_run_local_init_op] Done running local_init_op.
[2023-01-30 09:31:51,403] [INFO][basic_session_run_hooks.py:627:_save] Calling checkpoint listeners before saving checkpoint 6...
[2023-01-30 09:31:51,405] [INFO][basic_session_run_hooks.py:632:_save] Saving checkpoints for 6 into /nas/model.ckpt.
[2023-01-30 09:31:51,457] [INFO][basic_session_run_hooks.py:639:_save] Calling checkpoint listeners after saving checkpoint 6...
[2023-01-30 09:31:51,530] [INFO][global_step_hook.py:39:before_run] global_step: 6
[2023-01-30 09:31:51,648] [INFO][basic_session_run_hooks.py:265:_log_tensors] loss = 1186399.6, step = 6
[2023-01-30 09:31:51,650] [INFO][elastic_data_shard_report_hook.py:26:after_run] report_batch_done
[2023-01-30 09:31:51,654] [INFO][global_step_hook.py:39:before_run] global_step: 7
[2023-01-30 09:31:51,721] [INFO][elastic_data_shard_report_hook.py:26:after_run] report_batch_done
[2023-01-30 09:31:51,725] [INFO][global_step_hook.py:39:before_run] global_step: 8
[2023-01-30 09:31:51,732] [INFO][elastic_data_shard_report_hook.py:26:after_run] report_batch_done
[2023-01-30 09:31:51,734] [INFO][global_step_hook.py:39:before_run] global_step: 9
[2023-01-30 09:31:51,950] [INFO][basic_session_run_hooks.py:627:_save] Calling checkpoint listeners before saving checkpoint 9...
[2023-01-30 09:31:51,951] [INFO][basic_session_run_hooks.py:632:_save] Saving checkpoints for 9 into /nas/model.ckpt.
[2023-01-30 09:31:51,978] [INFO][basic_session_run_hooks.py:639:_save] Calling checkpoint listeners after saving checkpoint 9...
[2023-01-30 09:31:51,980] [INFO][global_step_hook.py:42:end] hook end
[2023-01-30 09:31:51,987] [INFO][estimator.py:361:train] Loss for final step: 1179187.6.
